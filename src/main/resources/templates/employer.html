<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="../static/css/card.css" th:href="@{/css/card.css}">

</head>

<body>

<nav class="navbar navbar-expand-lg navbar-light" style="background-color: #e3f2fd;">
    <a class="navbar-brand" href="/">WorkSwiper</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            <a class="nav-item nav-link" href="/">Главная страница</a>
            <a class="nav-item nav-link" href="/">Страница</a>
            <a class="nav-item nav-link active" href="/">Эта страница</a>
            <a class="btn btn-outline-danger my-2 my-sm-0" type="submit" href="/logout">Выйти</a>
        </div>
    </div>
</nav>
<table id="1" class="table table-striped table-hover" style="display:none;">
    <thead>
    <tr>
        <th scope="col"></th>
        <th scope="col"></th>
        <th scope="col"></th>
        <th scope="col"></th>
        <th scope="col"></th>
        <th scope="col"></th>
        <th scope="col"></th>
        <th scope="col"></th>
        <th scope="col"></th>
    </tr>
    </thead>
    <tbody>
    <div th:if="${not #lists.isEmpty(listUsers)}" style="display:none;">
        <tr th:each="user : ${listUsers}" class="table-tr">
            <th scope="row" class="table-th" th:text="${user.firstName}"></th>
            <th scope="row" class="table-th" th:text="${user.lastName}"></th>
            <th scope="row" class="table-th" th:text="${user.email}"></th>
        </tr>
    </div>
    <div th:if="${not #lists.isEmpty(personalDataList)}" style="display:none;">
        <tr th:each="personalData : ${personalDataList}" class="table-tr">
            <th scope="row" class="table-th" th:if="${personalData != null}" th:text="${personalData.telephone ?: ''}"></th>
            <th scope="row" class="table-th" th:if="${personalData != null}" th:text="${personalData.age ?: ''}"></th>
            <th scope="row" class="table-th" th:if="${personalData != null}" th:text="${personalData.country ?: ''}"></th>
            <th scope="row" class="table-th" th:if="${personalData != null}" th:text="${personalData.city ?: ''}"></th>
            <th scope="row" class="table-th" th:if="${personalData != null}" th:text="${personalData.education ?: ''}"></th>
            <th scope="row" class="table-th" th:if="${personalData != null}" th:text="${personalData.aboutme ?: ''}"></th>
        </tr>
    </div>
    <div th:if="${not #lists.isEmpty(TechStacks)}" style="display:none;">
        <tr th:each="techs : ${TechStacks}" class="table-tr">
            <th scope="row" class="table-th" th:text="${techs}"></th>
        </tr>
    </div>
    <div th:if="${not #lists.isEmpty(linksList)}" style="display:none;">
        <tr th:each="links : ${linksList}" class="table-tr">
            <th scope="row" class="table-th">
                <div th:if="${not #lists.isEmpty(links)}">
                    <ul>
                        <li th:each="link : ${links}">
                            <a class="text-black" th:text="${link.text}" th:href="${link.link}"></a>
                        </li>
                    </ul>
                </div>
            </th>
        </tr>
    </div>
    </tbody>
</table>



<div class="card-all-cards">

    <ion-icon id="dislike" name="heart-dislike"></ion-icon>
    <div id="swiper">
        <p class="card-firstname"></p>
        <p class="card-lastname"></p>
        <p class="card-email"></p>
        <p class="card-telephone"></p>
        <p class="card-age"></p>
        <p class="card-country"></p>
        <p class="card-city"></p>
        <p class="card-education"></p>
        <p class="card-aboutme"></p>
    </div>
    <ion-icon id="like" name="heart"></ion-icon>
<div/>
</div>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

</body>

<script lang="JavaScript">
    class Card {
        constructor({
                        onDismiss,
                        onLike,
                        onDislike,
                        FirstName,
                        LastName,
                        Email,
                        Telephone,
                        Age,
                        Country,
                        City,
                        Education,
                        AboutMe
                    }) {
            this.onDismiss = onDismiss;
            this.onLike = onLike;
            this.onDislike = onDislike;
            this.FirstName = FirstName;
            this.LastName = LastName;
            this.Email = Email;
            this.Telephone = Telephone;
            this.Age = Age;
            this.Country = Country;
            this.City = City;
            this.Education = Education;
            this.AboutMe = AboutMe;

            this.#init();
        }

        // private properties
        #startPoint;
        #offsetX;
        #offsetY;

        #isTouchDevice = () => {
            return (('ontouchstart' in window) ||
                (navigator.maxTouchPoints > 0) ||
                (navigator.msMaxTouchPoints > 0));
        }

        #init = () => {
            const card = document.createElement('div');
            card.classList.add('card');

            const textElement = document.createElement('p');
            textElement.textContent = this.FirstName;
            textElement.classList.add('card-firstname');
            card.append(textElement);

            const textElement2 = document.createElement('p');
            textElement2.textContent = this.LastName;
            textElement2.classList.add('card-lastname');
            card.append(textElement2);

            const textElement3 = document.createElement('p');
            textElement3.textContent = this.Email;
            textElement3.classList.add('card-email');
            card.append(textElement3);

            const textElement4 = document.createElement('p');
            textElement4.textContent = this.Telephone;
            textElement4.classList.add('card-telephone');
            card.append(textElement4);

            const textElement5 = document.createElement('p');
            textElement5.textContent = this.Age;
            textElement5.classList.add('card-age');
            card.append(textElement5);

            const textElement6 = document.createElement('p');
            textElement6.textContent = this.Country;
            textElement6.classList.add('card-country');
            card.append(textElement6);

            const textElement7 = document.createElement('p');
            textElement7.textContent = this.City;
            textElement7.classList.add('card-city');
            card.append(textElement7);

            const textElement8 = document.createElement('p');
            textElement8.textContent = this.Education;
            textElement8.classList.add('card-education');
            card.append(textElement8);

            const textElement9 = document.createElement('p');
            textElement9.textContent = this.AboutMe;
            textElement9.classList.add('card-aboutme');
            card.append(textElement9);


            this.element = card;
            if (this.#isTouchDevice()) {
                this.#listenToTouchEvents();
            } else {
                this.#listenToMouseEvents();
            }
        }

        #listenToTouchEvents = () => {
            this.element.addEventListener('touchstart', (e) => {
                const touch = e.changedTouches[0];
                if (!touch) return;
                const { clientX, clientY } = touch;
                this.#startPoint = { x: clientX, y: clientY }
                document.addEventListener('touchmove', this.#handleTouchMove);
                this.element.style.transition = 'transform 0s';
            });

            document.addEventListener('touchend', this.#handleTouchEnd);
            document.addEventListener('cancel', this.#handleTouchEnd);
        }

        #listenToMouseEvents = () => {
            this.element.addEventListener('mousedown', (e) => {
                const { clientX, clientY } = e;
                this.#startPoint = { x: clientX, y: clientY }
                document.addEventListener('mousemove', this.#handleMouseMove);
                this.element.style.transition = 'transform 0s';
            });

            document.addEventListener('mouseup', this.#handleMoveUp);

            // prevent card from being dragged
            this.element.addEventListener('dragstart', (e) => {
                e.preventDefault();
            });
        }

        #handleMove = (x, y) => {
            this.#offsetX = x - this.#startPoint.x;
            this.#offsetY = y - this.#startPoint.y;
            const rotate = this.#offsetX * 0.1;
            this.element.style.transform = `translate(${this.#offsetX}px, ${this.#offsetY}px) rotate(${rotate}deg)`;
            // dismiss card
            if (Math.abs(this.#offsetX) > this.element.clientWidth * 0.7) {
                this.#dismiss(this.#offsetX > 0 ? 1 : -1);
            }
        }

        // mouse event handlers
        #handleMouseMove = (e) => {
            e.preventDefault();
            if (!this.#startPoint) return;
            const { clientX, clientY } = e;
            this.#handleMove(clientX, clientY);
        }

        #handleMoveUp = () => {
            this.#startPoint = null;
            document.removeEventListener('mousemove', this.#handleMouseMove);
            this.element.style.transform = '';
        }

        // touch event handlers
        #handleTouchMove = (e) => {
            if (!this.#startPoint) return;
            const touch = e.changedTouches[0];
            if (!touch) return;
            const { clientX, clientY } = touch;
            this.#handleMove(clientX, clientY);
        }

        #handleTouchEnd = () => {
            this.#startPoint = null;
            document.removeEventListener('touchmove', this.#handleTouchMove);
            this.element.style.transform = '';
        }

        #dismiss = (direction) => {
            this.#startPoint = null;
            document.removeEventListener('mouseup', this.#handleMoveUp);
            document.removeEventListener('mousemove', this.#handleMouseMove);
            document.removeEventListener('touchend', this.#handleTouchEnd);
            document.removeEventListener('touchmove', this.#handleTouchMove);
            this.element.style.transition = 'transform 1s';
            this.element.style.transform = `translate(${direction * window.innerWidth}px, ${this.#offsetY}px) rotate(${90 * direction}deg)`;
            this.element.classList.add('dismissing');
            setTimeout(() => {
                this.element.remove();
            }, 1000);
            if (typeof this.onDismiss === 'function') {
                this.onDismiss();
            }
            if (typeof this.onLike === 'function' && direction === 1) {
                this.onLike();
            }
            if (typeof this.onDislike === 'function' && direction === -1) {
                this.onDislike();
            }
        }
    }
    // DOM
    const swiper = document.querySelector('#swiper');
    const like = document.querySelector('#like');
    const dislike = document.querySelector('#dislike');

    // constants
    const urls = [
        'https://source.unsplash.com/random/1000x1000/?sky',
        'https://source.unsplash.com/random/1000x1000/?landscape',
        'https://source.unsplash.com/random/1000x1000/?ocean',
        'https://source.unsplash.com/random/1000x1000/?moutain',
        'https://source.unsplash.com/random/1000x1000/?forest'
    ];

    const names = [];
    const lastname = [];
    const email = [];
    const telephone = [];
    const age = [];
    const country = [];
    const city = [];
    const education = [];
    const aboutme = [];

    // Перебираем строки таблицы и добавляем данные в соответствующие списки
    const table = document.getElementById('1');
    const rows = table.getElementsByTagName('tr');

    for (let i = 0; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName('th');
        if (cells.length === 3) {
            names.push(cells[0].textContent.trim());
            lastname.push(cells[1].textContent.trim());
            email.push(cells[2].textContent);
        } else if (cells.length > 3) {
            telephone.push(cells[0].textContent.trim());
            age.push(cells[1].textContent.trim());
            country.push(cells[2].textContent.trim());
            city.push(cells[3].textContent.trim());
            education.push(cells[4].textContent.trim());
            aboutme.push(cells[5].textContent.trim());
        }
    }








    // variables
    let cardCount = 0;

    // functions
    function appendNewCard() {
        const card = new Card({
            imageUrl: urls[cardCount],
            FirstName: names[cardCount],
            LastName: lastname[cardCount],
            Email: email[cardCount],
            Telephone: telephone[cardCount],
            Age: age[cardCount],
            Country: country[cardCount],
            City: city[cardCount],
            Education: education[cardCount],
            AboutMe: aboutme[cardCount],

            onDismiss: appendNewCard,
            onLike: () => {
                like.style.animationPlayState = 'running';
                like.classList.toggle('trigger');
            },
            onDislike: () => {
                dislike.style.animationPlayState = 'running';
                dislike.classList.toggle('trigger');
            }
        });

        const swiper = document.querySelector('#swiper');
        swiper.append(card.element);
        cardCount++;

        const cards = swiper.querySelectorAll('.card:not(.dismissing)');
        cards.forEach((card, index) => {
            card.style.setProperty('--i', index);
        });
    }


    // first 5 cards
    for (let i = 0; i < 5; i++) {
        appendNewCard();
    }


</script>

</html>